<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Molar Mass Assignment</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --success-bg: #d1fae5;
            --success-border: #10b981;
            --error-bg: #fee2e2;
            --error-border: #ef4444;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --bg-color: #f1f5f9;
        }

        body {
            font-family: 'Cambria', 'Cochin', Georgia, Times, 'Times New Roman', serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
            line-height: 1.4;
        }

        .container {
            max-width: 900px; 
            margin: 0 auto;
            min-height: 80vh;
        }

        header {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-left: 5px solid var(--primary);
            margin-bottom: 20px;
        }

        h1 { margin: 0; font-size: 1.8rem; color: var(--text-dark); font-weight: 800; }
        .instructions { 
            color: var(--text-light); 
            margin-top: 10px; 
            font-size: 1rem; 
            font-weight: 500;
            line-height: 1.5;
            max-width: 700px;
        }

        .score-display {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        #final-score {
            font-size: 1.6rem;
            font-weight: 900;
            color: #000;
            display: none;
            border: 3px solid #000;
            padding: 10px 25px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        button {
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.2s;
        }

        .btn-submit { 
            background-color: #059669; 
            color: white; 
            font-size: 1.1rem; 
            padding: 12px 24px; 
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 0 auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .btn-submit:hover { background-color: #047857; transform: translateY(-1px); }

        .btn-new {
            background-color: #64748b;
            color: white;
            margin-top: 10px;
        }

        .card {
            background: white;
            border: 2px solid #cbd5e1;
            border-radius: 10px;
            padding: 15px; 
            margin-bottom: 15px; 
            position: relative;
        }

        .problem-number {
            position: absolute; top: 10px; right: 15px;
            font-size: 2rem; color: #000; font-weight: bold; opacity: 0.1;
        }

        input[type="text"], input[type="number"], select {
            padding: 6px 8px;
            border: 1px solid #94a3b8;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
            text-align: center;
            transition: all 0.2s;
        }

        .calc-container { padding: 10px; overflow-x: auto; }
        .setup-row { display: flex; align-items: center; gap: 8px; margin-bottom: 12px; flex-wrap: nowrap; }
        .w-small { width: 65px; }
        .w-medium { width: 140px; } /* New sizing for the final mass */
        .w-large { width: 115px; }
        .operator { font-weight: 900; font-size: 1.2rem; color: #475569; }

        .final-answer {
            margin-top: 10px;
            padding-top: 15px;
            border-top: 2px dashed #e2e8f0;
            display: flex;
            gap: 15px;
            align-items: flex-end;
            justify-content: flex-start;
        }

        /* Grading Feedback Styles */
        input.correct {
            background-color: #d1fae5 !important;
            border-color: #10b981 !important;
            color: #065f46 !important;
        }
        input.incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
            color: #991b1b !important;
            box-shadow: 0 0 0 1px #ef4444;
        }

        .controls {
            text-align: center;
            margin: 40px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>

    <div class="container" id="main-content">
        <header>
            <h1>Calculating Molar Mass for Chemical Compounds</h1>
            <div class="instructions">
                Please complete each calculation. Show your work, show your units, and label everything. 
                When you are finished with each calculation, hit the <strong>Check my Work</strong> button to see how you did on it.
            </div>
        </header>

        <div class="score-display">
            <div id="final-score"></div>
        </div>

        <div id="problems-container"></div>

        <div class="controls">
            <button onclick="grade()" id="btn-submit" class="btn-submit">Check My Work</button>
            <button onclick="init()" class="btn-new">Generate New Problems</button>
        </div>
    </div>

    <script>
        const easyCompounds = [
            { name: "Water", formula: "H2O", mass: 18.015, elements: [{s:"H", m:1.008, q:2}, {s:"O", m:15.999, q:1}] },
            { name: "Methane", formula: "CH4", mass: 16.043, elements: [{s:"C", m:12.011, q:1}, {s:"H", m:1.008, q:4}] },
            { name: "Carbon Dioxide", formula: "CO2", mass: 44.009, elements: [{s:"C", m:12.011, q:1}, {s:"O", m:15.999, q:2}] },
            { name: "Ammonia", formula: "NH3", mass: 17.031, elements: [{s:"N", m:14.007, q:1}, {s:"H", m:1.008, q:3}] }
        ];

        const mediumCompounds = [
            { name: "Sodium Chloride", formula: "NaCl", mass: 58.443, elements: [{s:"Na", m:22.990, q:1}, {s:"Cl", m:35.453, q:1}] },
            { name: "Calcium Carbonate", formula: "CaCO3", mass: 100.086, elements: [{s:"Ca", m:40.078, q:1}, {s:"C", m:12.011, q:1}, {s:"O", m:15.999, q:3}] },
            { name: "Nitric Acid", formula: "HNO3", mass: 63.01, elements: [{s:"H", m:1.008, q:1}, {s:"N", m:14.007, q:1}, {s:"O", m:15.999, q:3}] }
        ];

        const hardCompounds = [
            { name: "Aluminum Sulfate", formula: "Al2(SO4)3", mass: 342.15, elements: [{s:"Al", m:26.982, q:2}, {s:"S", m:32.06, q:3}, {s:"O", m:15.999, q:12}] },
            { name: "Magnesium Phosphate", formula: "Mg3(PO4)2", mass: 262.855, elements: [{s:"Mg", m:24.305, q:3}, {s:"P", m:30.974, q:2}, {s:"O", m:15.999, q:8}] },
            { name: "Ammonium Carbonate", formula: "(NH4)2CO3", mass: 96.086, elements: [{s:"N", m:14.007, q:2}, {s:"H", m:1.008, q:8}, {s:"C", m:12.011, q:1}, {s:"O", m:15.999, q:3}] },
            { name: "Calcium Nitrate", formula: "Ca(NO3)2", mass: 164.086, elements: [{s:"Ca", m:40.078, q:1}, {s:"N", m:14.007, q:2}, {s:"O", m:15.999, q:6}] }
        ];

        let selectedProblems = [];

        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function init() {
            const container = document.getElementById('problems-container');
            container.innerHTML = '';
            document.getElementById('final-score').style.display = 'none';
            
            selectedProblems = [
                getRandomItem(easyCompounds),
                getRandomItem(mediumCompounds),
                getRandomItem(hardCompounds)
            ];
            
            selectedProblems.forEach((p, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                let rows = p.elements.map((el, ei) => `
                    <div class="setup-row" data-problem="${i}" data-el="${ei}">
                        <input type="text" value="${el.s}" readonly class="w-small" style="background:#f8fafc; font-weight:bold;">
                        <span class="operator">=</span>
                        <input type="number" step="0.001" class="inp-m w-large" placeholder="mass">
                        <input type="text" class="inp-u w-small" placeholder="unit">
                        <span class="operator">Ã—</span>
                        <input type="number" class="inp-q w-small" placeholder="qty">
                        <span class="operator">=</span>
                        <input type="number" step="0.001" class="inp-t w-large" placeholder="total">
                        <input type="text" class="inp-tu w-small" placeholder="unit">
                    </div>
                `).join('');

                card.innerHTML = `
                    <div class="problem-number">#${i+1}</div>
                    <h2 style="margin:0 0 15px 0;">Compound: <b>${p.name}, ${p.formula.replace(/(\d+)/g, '<sub>$1</sub>')}</b></h2>
                    <div class="calc-container">${rows}</div>
                    <div class="final-answer">
                        <div>
                            <label style="display:block; font-size:11px; font-weight:bold; color:var(--text-light);">FINAL MOLAR MASS</label>
                            <input type="number" step="0.001" id="ans-${i}" class="w-medium" style="font-weight:bold;" placeholder="">
                        </div>
                        <div>
                            <label style="display:block; font-size:11px; font-weight:bold; color:var(--text-light);">UNITS</label>
                            <input type="text" id="unit-${i}" style="width:80px;" placeholder="unit">
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function grade() {
            let score = 0;
            let total = 0;

            selectedProblems.forEach((p, i) => {
                const rows = document.querySelectorAll(`.setup-row[data-problem="${i}"]`);
                
                rows.forEach((row, ei) => {
                    const el = p.elements[ei];
                    const m = row.querySelector('.inp-m');
                    const u = row.querySelector('.inp-u');
                    const q = row.querySelector('.inp-q');
                    const t = row.querySelector('.inp-t');
                    const tu = row.querySelector('.inp-tu');

                    const checkNumeric = (input, val, target, tol = 0.05) => {
                        const numericVal = parseFloat(val);
                        const isCorrect = !isNaN(numericVal) && Math.abs(numericVal - target) < tol;
                        input.classList.remove('correct', 'incorrect');
                        input.classList.add(isCorrect ? 'correct' : 'incorrect');
                        if (isCorrect) score++;
                        total++;
                    };

                    const checkUnit = (input) => {
                        const valClean = input.value.toLowerCase().trim().replace(/\s/g, '');
                        const isCorrect = valClean === 'g/mol' || valClean === 'grams/mol' || valClean === 'amu';
                        input.classList.remove('correct', 'incorrect');
                        input.classList.add(isCorrect ? 'correct' : 'incorrect');
                        if (isCorrect) score++;
                        total++;
                    }

                    checkNumeric(m, m.value, el.m);
                    checkUnit(u);
                    checkNumeric(q, q.value, el.q, 0.001); 
                    checkNumeric(t, t.value, el.m * el.q);
                    checkUnit(tu);
                });

                const ans = document.getElementById(`ans-${i}`);
                const unt = document.getElementById(`unit-${i}`);
                
                const finalMassVal = parseFloat(ans.value);
                const ansCorrect = !isNaN(finalMassVal) && Math.abs(finalMassVal - p.mass) < 0.1;
                ans.classList.remove('correct', 'incorrect');
                ans.classList.add(ansCorrect ? 'correct' : 'incorrect');

                const untClean = unt.value.toLowerCase().trim().replace(/\s/g, '');
                const untCorrect = untClean === 'g/mol' || untClean === 'grams/mol' || untClean === 'amu';
                unt.classList.remove('correct', 'incorrect');
                unt.classList.add(untCorrect ? 'correct' : 'incorrect');
                
                if (ansCorrect) score++;
                if (untCorrect) score++;
                total += 2;
            });

            const scoreEl = document.getElementById('final-score');
            scoreEl.textContent = `Score: ${score} / ${total}`;
            scoreEl.style.display = 'block';
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.onload = init;
    </script>
</body>
</html>
